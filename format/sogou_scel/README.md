

# 搜狗细胞词库（.scel）格式简明说明

> **说明：** 本文所有数字均为小端字节序（Little Endian），所有字符串均为 UTF-16LE 编码，除非特殊说明，无需在每一处重复标注。

## 1. 文件结构总览

```
+------------------+----------------------+
| 文件头部         | 0x00 - 0x1540        |
+------------------+----------------------+
| 拼音列表         | 0x1540 - 动态长度     |
+------------------+----------------------+
| 词条数据区       | 动态偏移 - 动态长度   |
+------------------+----------------------+
| 短语数据区       | 动态偏移 - 动态长度   |
+------------------+----------------------+
| 黑名单数据区     | 动态偏移 - 动态长度   |
+------------------+----------------------+
```

---

## 2. 文件头部（0x00 - 0x1540）

- 0x00: 4字节，词条数据偏移
- 0x04: 4字节，魔数
- 0x0C: 16字节，搜狗魔改 MD5 校验和
- 0x1C: 变长，ID 标识符
- 0x5C: 4字节，短语数量
- 0x60: 4字节，短语数据偏移
- 0x64: 4字节，短语数据大小
- 0x6C: 4字节，短语结束偏移
- 0x74: 4字节，黑名单数量
- 0x78: 4字节，黑名单偏移
- 0x7C: 4字节，黑名单数据大小
- 0x11C: 4字节，创建时间戳（Unix时间）
- 0x120: 4字节，编码数量（重码组数）
- 0x124: 4字节，词汇总数量
- 0x128: 4字节，编码数据总大小
- 0x12C: 4字节，词汇数据总大小
- 0x130: 520字节，词库名称
- 0x338: 520字节，地点/分类
- 0x540: 2048字节，词库描述
- 0xD40: 2048字节，示例词汇

---

## 3. 拼音列表（0x1540起）

- 4字节：拼音数量
- 每项结构：
  - 2字节：索引
  - 2字节：拼音长度（字节数）
  - 变长：拼音内容

如拼音列表长度为0，使用内置拼音表。

---

## 4. 词条数据区

### 重码组结构

- 2字节：重码数（该拼音组合下的词条数）
- 2字节：拼音索引序列长度（字节数）
- 变长：拼音索引序列（每2字节一个索引）
- 后续为若干词条结构

### 词条结构

- 2字节：词汇长度（字节数）
- 变长：词汇内容
- 2字节：扩展信息长度（一般为 10）
- 4字节：词频
- 变长：扩展信息（一般全为0）

---

## 5. 短语数据区

每项结构：

- 17字节：信息块（info）
  - info[2] == 0x01：拼音短语
  - 其他：自定义短语
- 2字节：编码长度
- 变长：编码内容
  - 拼音短语：拼音索引序列（每2字节一个索引）
  - 自定义短语：编码字符串
- 2字节：词汇长度
- 变长：词汇内容

---

## 6. 黑名单数据区

每项结构：

- 2字节：词汇长度（需乘2为字节数）
- 变长：词汇内容

---

## 7. 校验和算法

- 搜狗魔改 MD5
- 魔数初值：[0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476]
- 魔改循环运算
- 以64字节分块，最后一块特殊填充
- 校验范围：从0x1540（拼音列表起）到文件末尾，不含头部校验和字段
